# EC2 VS Code Server Connection Tool

A secure and dynamic solution for setting up and connecting to VS Code Server running on an AWS EC2 instance.

## Overview

This repository provides a complete solution for:

1. Setting up a VS Code Server on an AWS EC2 instance with persistent storage
2. Dynamically updating EC2 security groups based on your current IP address
3. Establishing a secure SSH tunnel to the VS Code Server
4. Handling instance reboots and IP address changes automatically
5. Recreating the environment while preserving all your data

Based on the approach described in [VS Code on AWS](https://jimmydqv.com/vscode-on-aws/) with significant enhancements for persistence and security.

## Features

- **Persistent Storage**: All your projects and VS Code settings are stored on a dedicated EBS volume
- **Complete Setup**: Scripts for both server setup and client connection
- **Environment Recreation**: Easily recreate your environment while preserving all your data
- **Dynamic IP Management**: Automatically updates security group rules when your IP address changes
- **Instance Resilience**: Uses instance ID instead of hostname to handle EC2 public DNS changes after reboots
- **Least Privilege Security**: Implements security best practices by restricting SSH access to only your current IP
- **Efficient Updates**: Avoids unnecessary AWS API calls by checking if your IP has changed since last connection
- **User-Friendly Feedback**: Provides clear, color-coded status messages during the connection process

## Prerequisites

- AWS CLI installed and configured with appropriate permissions
- `jq` command-line JSON processor
- SSH key pair for EC2 authentication

## Scripts

This repository contains three main scripts:

1. **setup_vscode_server.sh**: Creates a new VS Code Server environment with persistent storage
2. **connect_vscode_server.sh**: Connects to your VS Code Server (generated by the setup script)
3. **recreate_vscode_server.sh**: Recreates your environment using the existing persistent storage

## Initial Setup

To create a new VS Code Server environment:

```bash
./setup_vscode_server.sh
```

This script will:
1. Create a persistent EBS volume for your development data
2. Launch an EC2 instance in the same availability zone as the volume
3. Attach the volume to the instance
4. Install and configure VS Code Server to use the persistent storage
5. Generate a connection script customized for your environment

## Connecting to Your VS Code Server

After setup is complete, connect to your VS Code Server:

```bash
./connect_vscode_server.sh
```

This will:
1. Update the security group to allow access only from your current IP
2. Establish an SSH tunnel to the VS Code Server
3. Provide the URL to access VS Code Server in your browser (http://localhost:8080)

## Recreating Your Environment

If you need to recreate your environment (e.g., after instance termination):

```bash
./recreate_vscode_server.sh
```

This script will:
1. Use your existing persistent EBS volume
2. Launch a new EC2 instance in the same availability zone
3. Attach your existing volume to the new instance
4. Configure VS Code Server to use your persistent data
5. Update the connection script with the new instance details

All your projects, extensions, and settings will be preserved!

## Directory Structure on the Server

- **/data/projects**: Main directory for all your development projects
- **/data/extensions**: VS Code extensions directory
- **/data/user-data**: VS Code user data directory
- **~/projects**: Symbolic link to /data/projects for easy access

## Security Considerations

This solution implements several security best practices:

- Restricts SSH access to only your current IP address
- Uses SSH key authentication instead of passwords
- Creates an encrypted tunnel for all VS Code Server traffic
- Avoids exposing the VS Code Server directly to the internet
- Binds the VS Code Server only to localhost on the EC2 instance

## Cost Considerations

- A t2.micro instance is eligible for the AWS Free Tier (for the first 12 months)
- Estimated monthly cost after Free Tier: ~$8-10/month for the instance (varies by region)
- EBS volume cost: ~$2/month for a 20GB gp3 volume
- Consider stopping the instance when not in use to reduce costs
- Use Spot Instances for even lower costs if you don't need continuous availability

## Troubleshooting

If you encounter issues:

1. Ensure your EC2 instance is running
2. Verify your AWS CLI is properly configured
3. Check that your SSH key has the correct permissions (600)
4. Confirm that VS Code Server is running on port 8080 on the EC2 instance
5. Check the code-server logs: `journalctl -u code-server@$USER`

## License

MIT

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.
